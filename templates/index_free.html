<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>æœŸå¾…å€¤ãƒ„ãƒ¼ãƒ«</title>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">
  <style>

    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }

    /* å…¨ä½“ã®åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;  /* ä¸¸ã¿ã®ã‚ã‚‹æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ */
      max-width: 800px;           /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…ã®ä¸Šé™ */
      margin: 0 auto;             /* ä¸­å¤®æƒãˆ */
      padding: 5px 20px; /* â† ã“ã“ã‚’èª¿æ•´ï¼ˆä¸Šä¸‹5pxï¼‰ */
      margin: 40px auto;         /* â† ä¸Šä¸‹å·¦å³ã«40pxä½™ç™½ã‚’è¿½åŠ ï¼ˆä¸­å¤®å¯„ã›ã‚‚ï¼‰ */
      margin-top: 10px;   /* ä¸Šã®ä½™ç™½ã‚’ç¸®ã‚ã‚‹ */
    }

    /* ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    h1 {
      text-align: center;         /* ä¸­å¤®å¯„ã› */
      margin-bottom: 0;        /* ä¸‹ã®ä½™ç™½ */
      margin-top: 10px;             /* â† ä¸Šã®ä½™ç™½ãªã— */
    }

    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®å…¨ä½“è¨­å®š */
    form {
      display: grid;              /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§2åˆ—ã«é…ç½® */
      grid-template-columns: 150px 1fr;  /* â† ãƒ©ãƒ™ãƒ«160pxã€å…¥åŠ›æ¬„ã¯æ®‹ã‚Šå…¨éƒ¨ */
      gap: 14px 20px;             /* è¡Œãƒ»åˆ—é–“ã®ä½™ç™½ */
      background-color: white;   /* èƒŒæ™¯ç™½ */
      padding: 20px;
      border-radius: 12px;        /* è§’ä¸¸ */
      margin-top: 10px; /* â† ã‚¿ã‚¤ãƒˆãƒ«ã¨ã®éš™é–“ã‚’ç‹­ã‚ã‚‹ */
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* ãƒ©ãƒ™ãƒ«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    label {
      display: flex;           /* ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ãƒœãƒƒã‚¯ã‚¹ã«ã™ã‚‹ */
      align-items: center;     /* ç¸¦æ–¹å‘ä¸­å¤®å¯„ã› */
      font-weight: bold;
      color: #1f2937;
      width: 100%;
      box-sizing: border-box;
      font-size: 14px; /* iOS ã‚ºãƒ¼ãƒ å¯¾ç­–ï¼š16px ä»¥ä¸Šã§ã‚ºãƒ¼ãƒ ã•ã‚Œã«ãã„ */
    }

    /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã¨æ•°å­—å…¥åŠ›æ¬„ã®å…±é€šè¨­å®š */
    select,
    input[type="number"] {
      padding: 4px 8px;
      font-size: 14px; /* iOS ã‚ºãƒ¼ãƒ å¯¾ç­–ï¼š16px ä»¥ä¸Šã§ã‚ºãƒ¼ãƒ ã•ã‚Œã«ãã„ */
      border: 1px solid #aaa;
      border-radius: 6px;
      box-sizing: border-box;
      width: 100%;
      max-width: 100%; /* è¿½åŠ ï¼ */
      height: 32px;
      -webkit-text-size-adjust: 100%; /* iOSã‚ºãƒ¼ãƒ å¯¾ç­– */
    }

    /* ãƒœã‚¿ãƒ³å…¨ä½“ã‚’ä¸­å¤®ã«æ•´åˆ— */
    .form-buttons {
      grid-column: 1 / -1;        /* ã‚°ãƒªãƒƒãƒ‰å…¨ä½“ã‚’ä½¿ç”¨ */
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px; /* â† ã“ã“ã§ä¸‹ã«ãšã‚‰ã™ */
    }

    /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã¨é€ä¿¡ãƒœã‚¿ãƒ³ã®å…±é€šãƒ‡ã‚¶ã‚¤ãƒ³ */
    .reset-btn,
    input[type="submit"] {
      padding: 12px 20px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      width: 140px; /* âœ… â† ãƒœã‚¿ãƒ³ã®å¹…ã‚’çµ±ä¸€ã™ã‚‹ */
    }

    /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚«ãƒ©ãƒ¼ */
    .reset-btn {
      background-color: #f87171;  /* èµ¤ç³» */
      color: white;
    }

    /* å‡ºåŠ›ãƒœã‚¿ãƒ³ã®ã‚«ãƒ©ãƒ¼ */
    input[type="submit"] {
      background-color: #60a5fa;  /* æ°´è‰² */
      color: white;
    }

    /* å‡ºåŠ›çµæœã‚¨ãƒªã‚¢ï¼ˆæˆåŠŸæ™‚ï¼‰ã®è¦‹ãŸç›® */
    .result {
      margin-top: 20px; /* â† ã“ã“ã‚’å°ã•ãã—ã¦è©°ã‚ã‚‹ï¼ˆä¾‹ï¼š8pxï¼‰ */
      background-color: #f0fdf4;      /* æ·¡ã„ç·‘èƒŒæ™¯ */
      border-left: 5px solid #34d399; /* ç·‘ã®å·¦ãƒ©ã‚¤ãƒ³ */
      padding: 16px;
      border-radius: 8px;
      font-size: 15px;
      color: #065f46;                 /* ç·‘ç³»æ–‡å­—è‰² */
    }

    /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ã®è¦‹ãŸç›® */
    .error {
      background-color: #fef2f2;      /* æ·¡ã„èµ¤èƒŒæ™¯ */
      border-left: 5px solid #ef4444; /* èµ¤ã®å·¦ãƒ©ã‚¤ãƒ³ */
      color: #991b1b;                 /* èµ¤ç³»æ–‡å­—è‰² */
      padding: 16px;
      border-radius: 8px;
      margin-top: 24px;
    }

    .text-red {
      color: red;
      font-weight: bold;
    }
    .text-blue {
      color: blue;
      font-weight: bold;
    }

    /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®å¼·èª¿è¡¨ç¤º */
    select:focus,
    input[type="number"]:focus {
      border-color: #6366f1;     /* é’è‰²ã«å¤‰åŒ– */
      outline: none;
    }









#advanced-section {
  grid-column: 1 / -1;
  display: none;
  grid-template-columns: inherit;
  gap: 12px 20px;
}

.toggle-btn {
  grid-column: 1 / -1;
  padding: 4px 12px;
  font-size: 14px;
  background-color: #eee;
  border: 1px solid #aaa;
  border-radius: 4px;
  cursor: pointer;
  text-align: left;
  margin-bottom: 6px;
  margin-top: 4px; /* â† ä¸Šã®ä½™ç™½ãŒç›®ç«‹ã¤åŸå›  */
}


  </style>
</head>




<body>
  <h1 style="display: flex; align-items: center; justify-content: center; gap: 10px;">
    <img src="{{ url_for('static', filename='icon.jpg') }}" alt="å·¦ç”»åƒ" style="height: 30px;">
    <span>æœŸå¾…å€¤ãƒ„ãƒ¼ãƒ«</span>
    <img src="{{ url_for('static', filename='icon.jpg') }}" alt="å³ç”»åƒ" style="height: 30px;">
  </h1>
  <form id="myForm" method="POST" action="/{{ url_path }}">

    <label for="machine">æ©Ÿç¨®å</label>
    <select name="machine" id="machine" required>
      <option value="{{ machine_name }}" selected>{{ machine_name }}</option>
    </select>

    <label for="mode">{{ labels.get("mode", "ãƒœãƒ¼ãƒŠã‚¹ï¼AT") }}</label>
    <select name="mode_display" id="mode" required>
      {% for opt in mode_options %}
        <option value="{{ opt }}" {% if opt == selected_mode %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="mode" id="mode_hidden" value="{{ selected_mode }}">

    <label for="time">æœã‚¤ãƒï¼æœã‚¤ãƒä»¥å¤–</label>
    <select name="time" id="time" required>
      <option value="æœã‚¤ãƒ" {% if selected_time == "æœã‚¤ãƒ" %}selected{% endif %}>æœã‚¤ãƒ</option>
      <option value="æœã‚¤ãƒä»¥å¤–" {% if selected_time == "æœã‚¤ãƒä»¥å¤–" %}selected{% endif %}>æœã‚¤ãƒä»¥å¤–</option>
    </select>

    <label for="game">æ‰“ã¡å‡ºã—ã‚²ãƒ¼ãƒ æ•°</label>
    <input type="number" id="game" name="game" min="0" value="{{input_game}}" required inputmode="numeric" pattern="[0-9]*">

<!-- ã‚¹ãƒ«ãƒ¼å›æ•° -->
<label for="through">ã‚¹ãƒ«ãƒ¼å›æ•°</label>
<select name="through_display" id="through" required data-selected="{{ selected_through }}">

  {% for opt in through_options %}
    <option value="{{ opt }}" {% if opt == selected_through %}selected{% endif %}>{{ opt }}</option>
  {% endfor %}
</select>
<input type="hidden" name="through" id="through_hidden" value="{{ selected_through }}">







  <!-- é …ç›®ã®é–‹é–‰ãƒœã‚¿ãƒ³ -->
  <button type="button" id="toggle-detail" onclick="toggleAdvanced()" class="toggle-btn">â–¼ è©³ç´°æ¡ä»¶ã‚’è¡¨ç¤º</button>

  <!-- å¯¾è±¡é …ç›® -->
  <div id="advanced-section" style="{{ 'display: grid;' if request.method == 'POST' else 'display: none;' }}">


    <label for="at_gap">{{ labels.get("at_gap", "ATé–“Gæ•°") }}</label>
    <select name="at_gap_display" id="at_gap" required data-selected="{{ selected_at_gap }}">
      {% for opt in at_gap_options %}
        <option value="{{ opt }}" {% if opt == selected_at_gap %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="at_gap" id="at_gap_hidden" value="{{ selected_at_gap }}">

    <label for="prev_game">{{ labels.get("prev_game", "å‰å›å½“é¸Gæ•°") }}</label>
    <select name="prev_game_display" id="prev_game" required data-selected="{{ selected_prev_game }}">
      {% for opt in prev_game_options %}
        <option value="{{ opt }}" {% if opt == selected_prev_game %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="prev_game" id="prev_game_hidden" value="{{ selected_prev_game }}">

    <label for="prev_coin">{{ labels.get("prev_coin", "å‰å›ç²å¾—æšæ•°") }}</label>
    <select name="prev_coin_display" id="prev_coin" required data-selected="{{ selected_prev_coin }}">
      {% for opt in prev_coin_options %}
        <option value="{{ opt }}" {% if opt == selected_prev_coin %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="prev_coin" id="prev_coin_hidden" value="{{ selected_prev_coin }}">

    <label for="prev_diff">{{ labels.get("prev_diff", "å‰å›å·®æšæ•°") }}</label>
    <select name="prev_diff_display" id="prev_diff" required data-selected="{{ selected_prev_diff }}">
      {% for opt in prev_diff_options %}
        <option value="{{ opt }}" {% if opt == selected_prev_diff %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="prev_diff" id="prev_diff_hidden" value="{{ selected_prev_diff }}">

    <label for="prev_renchan">{{ labels.get("prev_renchan", "å‰å›é€£è˜æ•°") }}</label>
    <select name="prev_renchan_display" id="prev_renchan" required data-selected="{{ selected_prev_renchan }}">
      {% for opt in prev_renchan_options %}
        <option value="{{ opt }}" {% if opt == selected_prev_renchan %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="prev_renchan" id="prev_renchan_hidden" value="{{ selected_prev_renchan }}">

    <label for="prev_type">{{ labels.get("prev_type", "å‰å›ç¨®åˆ¥") }}</label>
    <select name="prev_type_display" id="prev_type" required data-selected="{{ selected_prev_type }}">
      {% for opt in prev_type_options %}
        <option value="{{ opt }}" {% if opt == selected_prev_type %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="prev_type" id="prev_type_hidden" value="{{ selected_prev_type }}">

    <label for="custom_condition">æ©Ÿç¨®åˆ¥æ¡ä»¶</label>
    <select name="custom_condition_display" id="custom_condition" required data-selected="{{ selected_custom_condition }}">
      {% for opt in custom_condition_options %}
        <option value="{{ opt }}" {% if opt == selected_custom_condition %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="custom_condition" id="custom_condition_hidden" value="{{ selected_custom_condition }}">
  </div>



  <div class="form-buttons">
    <button type="button" id="reset-btn" class="reset-btn">ãƒªã‚»ãƒƒãƒˆ</button>
    <input type="submit" value="å‡ºåŠ›">
  </div>
  </form>

<!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé ˜åŸŸ -->
{% if error_msg %}
  <div id="error-area" style="color: red;">{{ error_msg }}</div>
{% endif %}

<!-- å‡ºåŠ›çµæœè¡¨ç¤ºé ˜åŸŸ -->
<div class="result" id="result-area">
  <p id="result-title"><strong>ã€å‡ºåŠ›çµæœã€‘</strong></p>

  {% if result == "ã‚µãƒ³ãƒ—ãƒ«ä¸è¶³" %}
    <p>ã‚µãƒ³ãƒ—ãƒ«ä¸è¶³ã®ãŸã‚ã€å‡ºåŠ›ã§ãã¾ã›ã‚“ã€‚</p>

  {% elif result %}
    <table id="result-table">
      <tbody>
        <tr><th>ä»¶æ•°ï¼š</th><td>{{ result["ä»¶æ•°"] }}</td></tr>
        <tr><th>åˆå½“ãŸã‚Šï¼š</th><td>{{ result["å¹³å‡REGã‚²ãƒ¼ãƒ æ•°"] }}</td></tr>
        <tr><th>ç²å¾—æšæ•°ï¼š</th><td>{{ result["å¹³å‡ATæšæ•°"] }}</td></tr>
        <tr>
          <th>æ©Ÿæ¢°å‰²ï¼š</th>
          <td>
            <span class="{{ 'text-red' if result['æ©Ÿæ¢°å‰²'] | replace('%', '') | float < 100 else 'text-blue' }}">
              {{ result["æ©Ÿæ¢°å‰²"] }}
            </span>
          </td>
        </tr>
        <tr>
          <th>æœŸå¾…å€¤ï¼š</th>
          <td>
            <span class="{{ 'text-red' if result['æœŸå¾…å€¤'] | replace('å††', '') | replace(',', '') | int < 0 else 'text-blue' }}">
              {{ result["æœŸå¾…å€¤"] }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>

  {% else %}
    <p>ã“ã“ã«å‡ºåŠ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
  {% endif %}
</div>




<!-- â–¼ ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«å„é¸æŠè‚¢ã‚’åˆæœŸåŒ–ã—ã€å‡ºåŠ›çµæœã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹å‡¦ç† -->
<script>
document.getElementById("reset-btn").addEventListener("click", (e) => {
  e.preventDefault();
  const ids = ["through", "at_gap", "prev_game", "prev_coin", "prev_diff", "prev_renchan", "prev_type", "custom_condition"];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if(el) {
      el.value = "ä¸å•";  // ãƒªã‚»ãƒƒãƒˆæ™‚ã«ã€Œä¸å•ã€ã«æˆ»ã™
      document.getElementById(`${id}_hidden`).value = "ä¸å•";  // hiddenã‚‚ãƒªã‚»ãƒƒãƒˆ
    }
  });

  // å‡ºåŠ›çµæœã®å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆãŸã ã—ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã¯åˆ†é›¢ï¼‰
  const resultArea = document.getElementById("result-area");
  resultArea.innerHTML = `
    <p id="result-title"><strong>ã€å‡ºåŠ›çµæœã€‘</strong></p>
    <p>ã“ã“ã«å‡ºåŠ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
  `;
});

</script>


<!-- â–¼ ã‚¹ãƒ«ãƒ¼å›æ•°ãŒã€Œ0ã€ã®ã¨ãã«ATé–“ã‚²ãƒ¼ãƒ æ•°ã®é¸æŠè‚¢ã‚’ã€Œä¸å•ã€ã§å›ºå®šã—ã€ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã™ã‚‹å‡¦ç† -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const atGapSelect = document.getElementById("at_gap");
  const throughSelect = document.getElementById("through");

  // åˆæœŸé¸æŠè‚¢ã‚’ä¿å­˜
  const originalAtGapOptions = Array.from(atGapSelect.options).map(opt => {
    return { value: opt.value, text: opt.text };
  });

  function updateAtGapBasedOnThrough() {
    const throughValue = throughSelect.value;

    if (throughValue === "0ã‚¹ãƒ«ãƒ¼") {
      // ä¸å•ã«ã—ã¦ãƒ­ãƒƒã‚¯
      atGapSelect.innerHTML = "";
      const option = document.createElement("option");
      option.value = "ä¸å•";
      option.textContent = "ä¸å•";
      atGapSelect.appendChild(option);
      atGapSelect.disabled = true;
    } else {
      // å…ƒã«æˆ»ã™
      atGapSelect.innerHTML = "";
      originalAtGapOptions.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt.value;
        option.textContent = opt.text;
        if (opt.value === atGapSelect.dataset.selected) {
          option.selected = true;
        }
        atGapSelect.appendChild(option);
      });
      atGapSelect.disabled = false;
    }
  }

  // åˆå›ã¨å¤‰æ›´æ™‚ã«åæ˜ 
  updateAtGapBasedOnThrough();
  throughSelect.addEventListener("change", updateAtGapBasedOnThrough);
});
</script>



<!-- â–¼ æ©Ÿç¨®ã”ã¨ã«å¯¾å¿œã—ãŸã€Œãƒ¢ãƒ¼ãƒ‰ï¼ˆCZ / ãƒœãƒ¼ãƒŠã‚¹ / ATãªã©ï¼‰ã€ã®é¸æŠè‚¢ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç† -->
<script>
  // Flask â†’ JavaScript ã¸æ¸¡ã™
  const modeOptionsByMachine = {{ mode_options_map | tojson }};
</script>



<!-- â–¼ ãƒ­ãƒƒã‚¯ï¼ˆå¤‰æ›´ä¸å¯ï¼‰ã«ã™ã‚‹å‡¦ç† -->
<script>
  // ğŸ” æ©Ÿç¨®ã”ã¨ã®ãƒ­ãƒƒã‚¯å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šï¼ˆFlaskã‹ã‚‰å—ã‘å–ã‚‹ï¼‰
  const lockedFieldMap = {{ locked_field_map | tojson }};

  // ğŸ” æœã‚¤ãƒã«ã‚ˆã‚‹åˆ¶å¾¡å¯¾è±¡
  const asaichiTargets = [
    "prev_game", "prev_coin", "prev_diff", "prev_renchan", "prev_type"
  ];

  // ğŸ” å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸé¸æŠè‚¢ã‚’ä¿å­˜ï¼ˆæœã‚¤ãƒãƒ»æ©Ÿç¨®ãƒ­ãƒƒã‚¯å…¼ç”¨ï¼‰
  const originalOptions = {};
  document.addEventListener("DOMContentLoaded", () => {
    [...asaichiTargets, "through", "at_gap"].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        originalOptions[id] = Array.from(el.options).map(opt => ({
          value: opt.value,
          text: opt.text
        }));
      }
    });

    // åˆå›å®Ÿè¡Œ
    updateFieldLocking(document.getElementById("machine").value);
    updateAsaichiLocking(document.getElementById("time").value);
  });

  // ğŸ” æ©Ÿç¨®ãƒ­ãƒƒã‚¯å‡¦ç†
  function updateFieldLocking(machineName) {
    const lockTargets = lockedFieldMap[machineName] || [];
    const allTargets = ["through", "at_gap", "custom_condition"];

    allTargets.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;

      if (lockTargets.includes(id) && id !== "through") {  // `through` ã‚’é™¤å¤–
        el.disabled = true;
        restoreSingleOption(el, "ä¸å•"); // ã€Œä¸å•ã€ã«è¨­å®š
      } else {
        restoreOriginalOptions(id, el);
        el.disabled = false;
      }
    });

    // mode ã¯ä¸å•ã«ã—ãªã„ãŒãƒ­ãƒƒã‚¯ã¯ã™ã‚‹
    const modeEl = document.getElementById("mode");
    if (modeEl) {
      modeEl.disabled = lockTargets.includes("mode");
    }
  }

  // ğŸ” æœã‚¤ãƒãƒ­ãƒƒã‚¯å‡¦ç†
  function updateAsaichiLocking(timeValue) {
    const isAsaichi = timeValue === "æœã‚¤ãƒ";

    asaichiTargets.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;

      if (isAsaichi && id !== "through") {  // `through` ã‚’é™¤å¤–
        el.disabled = true;
        restoreSingleOption(el, "ä¸å•"); // ã€Œä¸å•ã€ã«è¨­å®š
      } else {
        restoreOriginalOptions(id, el);
        el.disabled = false;
      }
    });
  }


  // ğŸ”„ ç‰¹å®šã®é¸æŠè‚¢ã ã‘ã«ã™ã‚‹ï¼ˆã€Œä¸å•ã€ã®ã¿ï¼‰
  function restoreSingleOption(selectEl, value) {
    selectEl.innerHTML = "";
    const opt = document.createElement("option");
    opt.value = value;
    opt.textContent = value;
    selectEl.appendChild(opt);
    selectEl.value = value;
  }

  // ğŸ”„ å…ƒã®é¸æŠè‚¢ã‚’å¾©å…ƒï¼ˆdata-selected ã«ã‚ˆã‚‹åˆæœŸå€¤å¾©å…ƒã‚‚å¯èƒ½ï¼‰
  function restoreOriginalOptions(id, selectEl) {
    if (!originalOptions[id]) return;
    const selected = selectEl.dataset.selected;
    selectEl.innerHTML = "";
    originalOptions[id].forEach(opt => {
      const option = document.createElement("option");
      option.value = opt.value;
      option.textContent = opt.text;
      if (opt.value === selected) {
        option.selected = true;
      }
      selectEl.appendChild(option);
    });
  }

  // ğŸ” ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  document.getElementById("machine").addEventListener("change", function () {
    updateFieldLocking(this.value);
  });

  document.getElementById("time").addEventListener("change", function () {
    updateAsaichiLocking(this.value);
  });
</script>





<!-- â–¼ æ©Ÿç¨®ã‚’å¤‰æ›´ã—ãŸã¨ãã«ã€ã‚¹ãƒ«ãƒ¼ã‚„å‰å›æ¡ä»¶ãªã©ã®é¸æŠè‚¢ã‚’ã€Œä¸å•ã€ã«æˆ»ã™å‡¦ç† -->
<script>
  const resetFieldsOnMachineChange = () => {
    // modeã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„
    const resetTargets = [
      "through",
      "at_gap",
      "prev_game",
      "prev_coin",
      "prev_diff",
      "prev_renchan",
      "prev_type"
    ];

    resetTargets.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        // ã€Œä¸å•ã€ãŒã‚ã‚Œã°é¸æŠã€ãªã‘ã‚Œã°è¿½åŠ ã—ã¦é¸æŠ
        let option = Array.from(el.options).find(opt => opt.value === "ä¸å•");
        if (!option) {
          option = new Option("ä¸å•", "ä¸å•");
          el.add(option);
        }
        el.value = "ä¸å•";
      }
    });

    // æ‰“ã¡å‡ºã—ã‚²ãƒ¼ãƒ æ•°ã‚’0ã«ãƒªã‚»ãƒƒãƒˆ
    const gameInput = document.getElementById("game");
    if (gameInput) {
      gameInput.value = "0";
    }
  };

  document.getElementById("machine").addEventListener("change", () => {
    resetFieldsOnMachineChange();
  });
</script>


<!-- â–¼ å‡ºåŠ›ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®ç”»é¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’è¨˜éŒ²ã—ã€ãƒšãƒ¼ã‚¸å†è¡¨ç¤ºå¾Œã«å¾©å…ƒã™ã‚‹å‡¦ç† -->
<script>
  document.getElementById("myForm").addEventListener("submit", function () {
    const scrollY = window.scrollY;
    sessionStorage.setItem("scrollPosition", scrollY);
  });

  window.addEventListener("load", function () {
    const savedY = sessionStorage.getItem("scrollPosition");
    if (savedY !== null) {
      window.scrollTo(0, parseInt(savedY));
      sessionStorage.removeItem("scrollPosition");
    }
  });
</script>


<!-- â–¼ è©³ç´°æ¡ä»¶ãƒˆã‚°ãƒ«çŠ¶æ…‹ã‚’ä¿æŒã—ãªãŒã‚‰é–‹é–‰ã™ã‚‹å‡¦ç† -->
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const section = document.getElementById("advanced-section");
    const button = document.querySelector(".toggle-btn");

    // ğŸ” çŠ¶æ…‹ã‚’ sessionStorage ã‹ã‚‰èª­ã¿å–ã‚Šï¼ˆtrue/falseï¼‰
    const keepOpen = sessionStorage.getItem("keepAdvancedOpen") === "true";

    // åˆæœŸè¡¨ç¤ºï¼ˆèµ·å‹•æ™‚ã¯é–‰ã˜ãŸçŠ¶æ…‹ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    section.style.display = keepOpen ? "grid" : "none";
    if (button) {
      button.textContent = keepOpen ? "â–² è©³ç´°æ¡ä»¶ã‚’éš ã™" : "â–¼ è©³ç´°æ¡ä»¶ã‚’è¡¨ç¤º";
    }

    // ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«çŠ¶æ…‹ã‚’ä¿å­˜
    if (button) {
      button.addEventListener("click", () => {
        const isVisible = section.style.display === "grid";
        section.style.display = isVisible ? "none" : "grid";
        button.textContent = isVisible ? "â–¼ è©³ç´°æ¡ä»¶ã‚’è¡¨ç¤º" : "â–² è©³ç´°æ¡ä»¶ã‚’éš ã™";

        // ğŸ”„ çŠ¶æ…‹ã‚’ä¿å­˜
        sessionStorage.setItem("keepAdvancedOpen", String(!isVisible));
      });
    }
  });
</script>



<!-- â–¼ å„selectã‚¿ã‚°ã®å€¤ã‚’å¯¾å¿œã™ã‚‹hiddenãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¦formé€ä¿¡æ™‚ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹å‡¦ç† -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("myForm").addEventListener("submit", function (e) {
    e.preventDefault();  // ãƒšãƒ¼ã‚¸é·ç§»ã‚’é˜²ã

    const syncFields = [
      "mode", "through", "at_gap", 
      "prev_game", "prev_coin", "prev_diff", 
      "prev_renchan", "prev_type", "custom_condition"
    ];
    
    syncFields.forEach(id => {
      const select = document.getElementById(id);
      const hidden = document.getElementById(`${id}_hidden`);
      
      if (select && hidden) {
        hidden.value = select.value;  // hiddenãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åæ˜ 
      }
    });

    // æ‰‹å‹•ã§ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’è¡Œã†
    this.submit();  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’å®Ÿè¡Œ
  });
});

</script>

<script>
  // ãƒ­ãƒƒã‚¯å‡¦ç†ã‚’é–¢æ•°åŒ–
  function lockFields() {
    const freeLockedFields = [
      "at_gap", 
      "prev_game", 
      "prev_coin", 
      "prev_diff", 
      "prev_renchan", 
      "prev_type", 
      "custom_condition"
    ];

    freeLockedFields.forEach(id => {
      const select = document.getElementById(id);
      if (select) {
        // "ä¸å•"ã‚’è¨­å®š
        const option = select.querySelector('option[value="ä¸å•"]');
        if (option) {
          select.value = "ä¸å•";  // æ—¢ã«é¸æŠè‚¢ãŒã€Œä¸å•ã€ã¨ã—ã¦å­˜åœ¨ã™ã‚‹å ´åˆ
        } else {
          console.warn(`Option "ä¸å•" ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${id}`);
        }
        
        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒ­ãƒƒã‚¯ï¼ˆdisabledã«ã™ã‚‹ï¼‰
        select.disabled = true;
      } else {
        console.warn(`select è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${id}`);
      }
    });
  }

  // ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿å¾Œã«å¸¸ã«ãƒ­ãƒƒã‚¯ã‚’é©ç”¨
  window.addEventListener("DOMContentLoaded", () => {
    lockFields();
    
    // MutationObserver ã‚’ä½¿ã£ã¦ãƒšãƒ¼ã‚¸å†…ã®å¤‰æ›´ã‚’ç›£è¦–
    const observer = new MutationObserver(() => {
      lockFields();  // DOMã®å¤‰æ›´ãŒã‚ã‚Œã°ãƒ­ãƒƒã‚¯ã‚’é©ç”¨
    });

    // ç›£è¦–å¯¾è±¡ã‚’æŒ‡å®šï¼ˆbodyå…¨ä½“ã‚’ç›£è¦–ï¼‰
    observer.observe(document.body, {
      childList: true, // æ–°ã—ã„ãƒãƒ¼ãƒ‰ãŒè¿½åŠ ãƒ»å‰Šé™¤ã•ã‚ŒãŸå ´åˆã«ç›£è¦–
      subtree: true     // å­å­«ãƒãƒ¼ãƒ‰ã‚‚ç›£è¦–å¯¾è±¡ã«ã™ã‚‹
    });
  });
</script>





</body>
</html>


