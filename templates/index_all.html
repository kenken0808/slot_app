<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no"
  />

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="けんけんスロット分析ツール">
  <meta property="og:description" content="実践データから機械割や期待値を自動計算できる分析ツールです。">
  <meta property="og:url" content="{{ og_url }}">
  <meta property="og:image" content="{{ og_image }}">
  <meta property="og:site_name" content="けんけんスロット分析ツール">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="けんけんスロット分析ツール">
  <meta name="twitter:description" content="けんけんスロット分析ツール">
  <meta name="twitter:image" content="{{ tw_image }}">  <!-- ★ ここだけ別URL -->

  <title>けんけんスロット分析ツール</title>

  <!-- フォント -->
  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap"
    rel="stylesheet"
  />

  <style>
    /* =====================================================
       ベース
    ===================================================== */
    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }
    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      max-width: 800px;
      margin: 10px auto 40px; /* 上10px, 下40px */
      padding: 5px 20px;
    }
    h1 {
      text-align: center;
      margin: 10px 0 0;
      font-size: 20px;
    }


    /* =====================================================
       フォーム（シンプル版）
    ===================================================== */
    form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;                 /* 余白は少し広めのまま */
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-top: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);  /* 外側の影は維持（不要なら削除OK） */
    }

    /* ---- ラベル（14pxのまま） ---- */
    label {
      display: block;
      font-weight: 600;
      color: #1f2937;
      font-size: 14px;
      margin-bottom: 6px;
    }

    /* ---- 入力（カード化なし） ---- */
    select,
    input[type="number"] {
      padding: 8px 10px;
      font-size: 14px;
      border: 1px solid #aaa;
      border-radius: 6px;
      box-sizing: border-box;
      width: 100%;
      height: 42px;              /* 押しやすさは維持 */
      -webkit-text-size-adjust: 100%;
      background: #fff;          /* ← 元の白に戻す */
      box-shadow: none;          /* ← 影なし */
    }

    /* range内も高さ統一 */
    .range select {
      height: 42px;
    }

    /* フォーカス */
    select:focus,
    input[type="number"]:focus {
      border-color: #6366f1;
      outline: none;
      box-shadow: 0 0 0 2px rgba(99,102,241,0.12);
    }

    /* ---- セクション区切り線（そのまま使えます） ---- */
    .section-divider {
      border-top: 1px solid #e5e7eb;
      margin: 10px 0;
    }

    /* ---- ボタン行 ---- */
    .form-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .reset-btn,
    input[type="submit"] {
      padding: 14px 22px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      width: 160px;
    }






    /* =====================================================
       結果/エラー表示
    ===================================================== */
    .result {
      margin-top: 20px;
      background-color: #f0fdf4;
      border-left: 5px solid #34d399;
      padding: 16px;
      border-radius: 8px;
      font-size: 15px;
      color: #065f46;
    }
    .error {
      background-color: #fef2f2;
      border-left: 5px solid #ef4444;
      color: #991b1b;
      padding: 16px;
      border-radius: 8px;
      margin-top: 24px;
    }
    .text-red { color: red; font-weight: bold; }
    .text-blue { color: blue; font-weight: bold; }

    /* =====================================================
       詳細条件（開閉セクション）
    ===================================================== */
    #advanced-section {
      grid-column: 1 / -1;
      display: none;                 /* 初期は非表示（JSで制御） */
      grid-template-columns: inherit;
      gap: 12px 20px;
    }
    .toggle-btn {
      grid-column: 1 / -1;
      padding: 4px 12px;
      font-size: 14px;
      background-color: #eee;
      border: 1px solid #aaa;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
      margin: 4px 0 6px;
    }

    /* =====================================================
       OGPカード用CSS
    ===================================================== */
    .og-card{
      display:flex;
      gap:12px;
      text-decoration:none;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:12px;
      margin-top:14px;
      align-items:flex-start;
      transition:transform .06s ease, box-shadow .06s ease;
    }
    .og-card:hover{
      transform: translateY(-1px);
      box-shadow:0 2px 10px rgba(0,0,0,.08);
    }
    .og-thumb{
      flex:0 0 120px;
      max-width:120px;
      aspect-ratio: 1.8/1;
      overflow:hidden;
      border-radius:8px;
      background:#f8fafc;
    }
    .og-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .og-body{ min-width:0; }
    .og-title{
      font-weight:700;
      color:#111827;
      line-height:1.3;
      margin-bottom:4px;
    }
    .og-desc{
      color:#4b5563;
      font-size:0.95rem;
      line-height:1.5;
      max-height:3.0em;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }
    .og-site{
      color:#6b7280;
      font-size:0.85rem;
      margin-top:6px;
    }
  </style>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-HXM85ZV043"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HXM85ZV043');
</script>

<body>
  <!-- タイトル -->
  <h1 style="display:flex; align-items:center; justify-content:center; gap:10px;">
    <img src="{{ url_for('static', filename='icon.jpg') }}" alt="左画像" style="height:24px;">
    <span>けんけんスロット分析ツール</span>
    <img src="{{ url_for('static', filename='icon.jpg') }}" alt="右画像" style="height:24px;">
  </h1>

  <!-- メインフォーム -->
  <form id="myForm" method="POST" action="/all">
    <!-- 機種名 -->
    <div class="section-divider"></div>
    <label for="machine">機種名</label>
    <select id="machine" name="machine" onchange="this.form.submit()">
      {% for key, name in display_names %}
        <option value="{{ key }}" {% if key == selected_machine %}selected{% endif %}>
          {{ name }}
        </option>
      {% endfor %}
    </select>




    <!-- モード（表示用と送信用hidden） -->
    <div class="section-divider"></div>
    <label for="mode">{{ labels.get("mode", "ボーナス／AT") }}</label>
    <select name="mode_display" id="mode" required>
      {% for opt in mode_options %}
        <option value="{{ opt }}" {% if opt == selected_mode %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
    <input type="hidden" name="mode" id="mode_hidden" value="{{ selected_mode }}">

    <!-- 朝イチ/朝イチ以外 -->
    <div class="section-divider"></div>
    <label for="time">朝イチ／朝イチ以外</label>
    <select name="time" id="time" required>
      <option value="朝イチ" {% if selected_time == "朝イチ" %}selected{% endif %}>朝イチ</option>
      <option value="朝イチ以外" {% if selected_time == "朝イチ以外" %}selected{% endif %}>朝イチ以外</option>
    </select>

    <!-- 打ち出しゲーム数 -->
    <div class="section-divider"></div>
    <label for="game">打ち出しG数</label>
    <input
      type="number"
      id="game"
      name="game"
      min="0"
      value="{{ input_game }}"
      required
      inputmode="numeric"
      pattern="[0-9]*"
    >








<style>
/* min ～ max 専用 */
.range {
  display: grid;
  grid-template-columns: 1fr 30px 1fr; /* min / ～ / max */
  align-items: center;
  width: 100%;
}

.range select {
  width: 100%;
  height: 36px;
}

.range .separator {
  text-align: center;
}
</style>




  <!-- スルー回数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("through", "スルー回数") }}</label>
  <div class="range">
    <select name="through_min">
      {% for i in range(through[0], through[1]+1, through[2]) %}
        <option value="{{ i }}" {% if i == selected_through_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="through_max">
      {% for i in range(through[0], through[1]+1, through[2]) %}
        <option value="{{ i }}" {% if i == selected_through_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- AT間G数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("at_gap", "AT間G数") }}</label>
  <div class="range">
    <select name="at_gap_min">
      {% for i in range(at_gap[0], at_gap[1]+1, at_gap[2]) %}
        <option value="{{ i }}" {% if i == selected_at_gap_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="at_gap_max">
      {% for i in range(at_gap[0], at_gap[1]+1, at_gap[2]) %}
        <option value="{{ i }}" {% if i == selected_at_gap_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- 前回当選G数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("prev_game", "前回当選G数") }}</label>
  <div class="range">
    <select name="prev_game_min">
      {% for i in range(prev_game[0], prev_game[1]+1, prev_game[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_game_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="prev_game_max">
      {% for i in range(prev_game[0], prev_game[1]+1, prev_game[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_game_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- 前回獲得枚数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("prev_coin", "前回獲得枚数") }}</label>
  <div class="range">
    <select name="prev_coin_min">
      {% for i in range(prev_coin[0], prev_coin[1]+1, prev_coin[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_coin_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="prev_coin_max">
      {% for i in range(prev_coin[0], prev_coin[1]+1, prev_coin[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_coin_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- 前回差枚数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("prev_diff", "前回差枚数") }}</label>
  <div class="range">
    <select name="prev_diff_min">
      {% for i in range(prev_diff[0], prev_diff[1]+1, prev_diff[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_diff_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="prev_diff_max">
      {% for i in range(prev_diff[0], prev_diff[1]+1, prev_diff[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_diff_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- 前回連荘数 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("prev_renchan", "前回連荘数") }}</label>
  <div class="range">
    <select name="prev_renchan_min">
      {% for i in range(prev_renchan[0], prev_renchan[1]+1, prev_renchan[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_renchan_min %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    <span class="separator">～</span>
    <select name="prev_renchan_max">
      {% for i in range(prev_renchan[0], prev_renchan[1]+1, prev_renchan[2]) %}
        <option value="{{ i }}" {% if i == selected_prev_renchan_max %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- 前回種別 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("prev_type", "前回種別") }}</label>
  <select name="prev_type">
    {% for opt in prev_type_options %}
      <option value="{{ opt }}" {% if opt == selected_prev_type %}selected{% endif %}>{{ opt }}</option>
    {% endfor %}
  </select>

  <!-- 機種別条件 -->
  <div class="section-divider"></div>
  <label>{{ labels.get("custom_condition", "機種別条件") }}</label>
  <select name="custom_condition">
    {% for opt in custom_condition_options %}
      <option value="{{ opt }}" {% if opt == selected_custom_condition %}selected{% endif %}>{{ opt }}</option>
    {% endfor %}
  </select>
  <div class="section-divider"></div>







    <!-- ボタン群 -->
    <div class="form-buttons">
      <button type="button" id="reset-btn" class="reset-btn">リセット</button>
      <input type="submit" value="出力">
    </div>
  </form>

  <!-- エラーメッセージ -->
  {% if error_msg %}
    <div id="error-area" class="error">{{ error_msg }}</div>
  {% endif %}

  <!-- 出力結果 -->
  <div class="result" id="result-area">
    <p id="result-title"><strong>【出力結果】</strong></p>

    {% if result == "サンプル不足" %}
      <p>サンプル不足のため、出力できません。</p>

    {% elif result %}
      <table id="result-table">
        <tbody>
          <tr><th>件数：</th><td>{{ result["件数"] }}</td></tr>
          <tr><th>初当たり：</th><td>{{ result["平均REGゲーム数"] }}</td></tr>
          <tr><th>獲得枚数：</th><td>{{ result["平均AT枚数"] }}</td></tr>
          <tr>
            <th>機械割：</th>
            <td>
              <span class="{{ 'text-red' if result['機械割'] | replace('%', '') | float < 100 else 'text-blue' }}">
                {{ result["機械割"] }}
              </span>
            </td>
          </tr>
          <tr>
            <th>期待値：</th>
            <td>
              <span class="{{ 'text-red' if result['期待値'] | replace('円', '') | replace(',', '') | int < 0 else 'text-blue' }}">
                {{ result["期待値"] }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    {% else %}
      <p>ここに出力結果が表示されます。</p>
    {% endif %}
  </div>

  <!-- noteリンク -->
  {% if link_preview %}
    <a class="og-card" href="{{ link_preview.url }}" target="_blank" rel="noopener">
      {% if link_preview.image %}
        <div class="og-thumb">
          <img src="{{ link_preview.image }}" alt="">
        </div>
      {% endif %}
      <div class="og-body">
        <div class="og-title">{{ link_preview.title }}</div>
        {% if link_preview.description %}
          <div class="og-desc">{{ link_preview.description }}</div>
        {% endif %}
        <div class="og-site">{{ link_preview.site_name or link_preview.url }}</div>
      </div>
    </a>
  {% endif %}

  <!-- =====================================================
       JS：リセット（選択肢＆結果表示を初期化）
  ====================================================== -->
  <script>
    document.getElementById("reset-btn").addEventListener("click", (e) => {
      e.preventDefault();

      const ids = [
        "through","at_gap","prev_game","prev_coin",
        "prev_diff","prev_renchan","prev_type","custom_condition"
      ];

      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = "不問";
        const hidden = document.getElementById(`${id}_hidden`);
        if (hidden) hidden.value = "不問";
      });

      const resultArea = document.getElementById("result-area");
      resultArea.innerHTML = `
        <p id="result-title"><strong>【出力結果】</strong></p>
        <p>ここに出力結果が表示されます。</p>
      `;
    });
  </script>

  <!-- =====================================================
       JS：モード選択肢（Flask → JS へ受け渡し）
  ====================================================== -->
  <script>
    const modeOptionsByMachine = {{ mode_options_map | tojson }};
  </script>

  <!-- =====================================================
       JS：ロック対象（機種ごと）＋ 朝イチ時の制御
  ====================================================== -->
<script>
  // サーバから渡すロック設定（表示名キー）
  const lockedFieldMap = {{ locked_field_map | tojson }};

  // ロック対象になり得るIDを一元管理
  const lockableIds = [
    "through","at_gap","prev_diff","prev_game","prev_coin","prev_renchan","prev_type","custom_condition"
  ];

  // ★ 朝イチで不問固定にする対象に at_gap を含める
  const asaichiTargets = ["at_gap","prev_game","prev_coin","prev_diff","prev_renchan","prev_type","custom_condition"];

  // 元の<option>退避
  const originalOptions = {};

  // 現在機種のロック対象を取得
  function getLockTargets() {
    const m = document.getElementById("machine")?.value;
    return lockedFieldMap[m] || [];
  }

  document.addEventListener("DOMContentLoaded", () => {
    // 機種名は常にロック
    const machineEl = document.getElementById("machine");
    if (machineEl) machineEl.disabled = false;

    // 元の選択肢をロック候補すべてで退避
    lockableIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        originalOptions[id] = Array.from(el.options).map(opt => ({
          value: opt.value, text: opt.text
        }));
      }
    });

    // 初期適用
    updateFieldLocking(document.getElementById("machine").value);
    updateAsaichiLocking(document.getElementById("time").value);
    updateAtGapBasedOnThrough(); // 0スルー→AT間G数の固定
  });

  // 機種ごとのロック適用
  function updateFieldLocking(machineName) {
    const lockTargets = lockedFieldMap[machineName] || [];

    lockableIds.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;

      if (lockTargets.includes(id)) {
        el.disabled = true;
        restoreSingleOption(el, "不問");
      } else {
        restoreOriginalOptions(id, el);
        el.disabled = false;
      }
    });

    const modeEl = document.getElementById("mode");
    if (modeEl) modeEl.disabled = lockTargets.includes("mode");

    // スルーとの連動は最後に再評価
    updateAtGapBasedOnThrough();
  }

  // 朝イチのときは一部項目を不問固定（機種ロックは維持）
  function updateAsaichiLocking(timeValue) {
    const isAsaichi = (timeValue === "朝イチ");
    const lockTargets = getLockTargets();

    asaichiTargets.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;

      if (isAsaichi && id !== "through") {
        el.disabled = true;
        restoreSingleOption(el, "不問");
      } else {
        restoreOriginalOptions(id, el);
        // 機種ロック対象は解除しない
        el.disabled = lockTargets.includes(id);
        if (el.disabled) restoreSingleOption(el, "不問");
      }
    });
  }

  // 0スルー時は AT間G数 を不問固定（★ 朝イチ最優先）
  function updateAtGapBasedOnThrough() {
    const atGapSelect = document.getElementById("at_gap");
    const throughSelect = document.getElementById("through");
    if (!atGapSelect || !throughSelect) return;

    // ★ 追加：朝イチなら常に at_gap は不問固定＋disabled
    const isAsaichi = document.getElementById("time")?.value === "朝イチ";
    if (isAsaichi) {
      restoreSingleOption(atGapSelect, "不問");
      atGapSelect.disabled = true;
      return;
    }

    const lockTargets = getLockTargets();
    // 機種ロックに at_gap が含まれるなら常に固定
    if (lockTargets.includes("at_gap")) {
      restoreSingleOption(atGapSelect, "不問");
      atGapSelect.disabled = true;
      return;
    }

    // 通常時：0スルーなら固定、それ以外は選択可
    const throughValue = throughSelect.value;
    if (throughValue === "0スルー") {
      restoreSingleOption(atGapSelect, "不問");
      atGapSelect.disabled = true;
    } else {
      restoreOriginalOptions("at_gap", atGapSelect);
      atGapSelect.disabled = false;
    }
  }

  // Select を「不問」1択にする
  function restoreSingleOption(selectEl, value) {
    selectEl.innerHTML = "";
    const opt = document.createElement("option");
    opt.value = value;
    opt.textContent = value;
    selectEl.appendChild(opt);
    selectEl.value = value;
  }

  // Select の元の選択肢を復元
  function restoreOriginalOptions(id, selectEl) {
    if (!originalOptions[id]) return;
    const selected = selectEl.dataset.selected;
    selectEl.innerHTML = "";
    originalOptions[id].forEach(opt => {
      const option = document.createElement("option");
      option.value = opt.value;
      option.textContent = opt.text;
      if (opt.value === selected) option.selected = true;
      selectEl.appendChild(option);
    });
  }

  // イベント
  document.getElementById("machine").addEventListener("change", function () {
    updateFieldLocking(this.value);
    updateAtGapBasedOnThrough(); // 念のため再評価
  });
  document.getElementById("time").addEventListener("change", function () {
    updateAsaichiLocking(this.value);
    updateAtGapBasedOnThrough(); // ★ 朝イチ切替時にも反映
  });
  document.getElementById("through").addEventListener("change", function () {
    updateAtGapBasedOnThrough();
  });
</script>

  <!-- =====================================================
       JS：機種変更時に各条件を「不問」に戻す
  ====================================================== -->
  <script>
    function resetFieldsOnMachineChange() {
      const resetTargets = ["through","at_gap","prev_game","prev_coin","prev_diff","prev_renchan","prev_type"];
      resetTargets.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        let option = Array.from(el.options).find(opt => opt.value === "不問");
        if (!option) el.add(new Option("不問", "不問"));
        el.value = "不問";
      });

      const gameInput = document.getElementById("game");
      if (gameInput) gameInput.value = "0";
    }
    document.getElementById("machine").addEventListener("change", () => {
      resetFieldsOnMachineChange();
    });
  </script>

  <!-- =====================================================
       JS：送信後のスクロール位置を復元
  ====================================================== -->
  <script>
    document.getElementById("myForm").addEventListener("submit", function () {
      const scrollY = window.scrollY;
      sessionStorage.setItem("scrollPosition", scrollY);
    });
    window.addEventListener("load", function () {
      const savedY = sessionStorage.getItem("scrollPosition");
      if (savedY !== null) {
        window.scrollTo(0, parseInt(savedY));
        sessionStorage.removeItem("scrollPosition");
      }
    });
  </script>

  <!-- =====================================================
       JS：詳細条件トグル（状態保持）
  ====================================================== -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const section = document.getElementById("advanced-section");
      const button  = document.getElementById("toggle-detail");
      const keepOpen = sessionStorage.getItem("keepAdvancedOpen") === "true";

      section.style.display = keepOpen ? "grid" : "none";
      if (button) button.textContent = keepOpen ? "▲ 詳細条件を隠す（前回条件）" : "▼ 詳細条件を表示（前回条件）";

      if (button) {
        button.addEventListener("click", () => {
          const isVisible = section.style.display === "grid";
          section.style.display = isVisible ? "none" : "grid";
          button.textContent = isVisible ? "▼ 詳細条件を表示（前回条件）" : "▲ 詳細条件を隠す（前回条件）";
          sessionStorage.setItem("keepAdvancedOpen", String(!isVisible));
        });
      }
    });
  </script>

  <!-- =====================================================
       JS：select値をhiddenへコピーして送信（name整合のため）
  ====================================================== -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("myForm").addEventListener("submit", function (e) {
        e.preventDefault(); // 一旦止める

        const syncFields = [
          "mode","through","at_gap",
          "prev_game","prev_coin","prev_diff",
          "prev_renchan","prev_type","custom_condition"
        ];

        syncFields.forEach(id => {
          const select = document.getElementById(id);
          const hidden = document.getElementById(`${id}_hidden`);
          if (select && hidden) hidden.value = select.value;
        });

        this.submit(); // コピー後に送信
      });
    });
  </script>


  <script>
  function syncMinMax(minName, maxName) {
    const minEl = document.querySelector(`select[name="${minName}"]`);
    const maxEl = document.querySelector(`select[name="${maxName}"]`);

    if (!minEl || !maxEl) return;

    minEl.addEventListener("change", () => {
      const minVal = parseInt(minEl.value, 10);

      [...maxEl.options].forEach(opt => {
        opt.disabled = parseInt(opt.value, 10) < minVal;
      });

      if (parseInt(maxEl.value, 10) < minVal) {
        maxEl.value = minVal;
      }
    });
  }

  // 対象項目
  syncMinMax("through_min", "through_max");
  syncMinMax("at_gap_min", "at_gap_max");
  syncMinMax("prev_game_min", "prev_game_max");
  syncMinMax("prev_coin_min", "prev_coin_max");
  syncMinMax("prev_diff_min", "prev_diff_max");
  syncMinMax("prev_renchan_min", "prev_renchan_max");
  </script>


</body>
</html>
